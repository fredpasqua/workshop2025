<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <title>Summer Workshop 2025 Reading Session Titles</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="modal.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"
        integrity="sha512-YcsIPGdhPK4P/uRW6/sruonlYj+Q7UHWeKfTAkBW+g83NKM+jMJFJ4iAPfSnVp7BKD4dKMHmVSvICUbE/V1sSw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>

<body>
<!-- Popup Form Modal -->
<div id="info-form-modal"
    style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0, 0, 0, 0.796); z-index:1000; align-items:center; justify-content:center;">
    <div style="background:#fff; padding:20px; margin-left:auto; margin-right: auto; border-radius:8px; max-width:80vw;">
        <h3>Enter Your School Information to appear on price quote.</h3>
        <form id="teacher-info-form">
            <label for="teacher-name">Teacher Name</label><br>
            <input type="text" id="teacher-name" name="teacher-name" required><br><br>
            <label for="district-name">District</label><br>
            <input type="text" id="district-name" name="district-name" required><br><br>
            <label for="school-name">School</label><br>
            <input type="text" id="school-name" name="school-name" required><br><br>
            <label for="email">Email</label><br>
            <input type="email" id="email" name="email" required><br><br>
            <button type="submit">Save Info</button>
        </form>
    </div>
</div>
    <img src="./NEMClogo.jpg" style="height: 150px;" alt="NEMC logo featuring a stylized penguin with a yellow beak and white eyes inside a rounded square with a red and orange gradient background. The text NEMC appears in bold white letters on a red banner at the bottom left. To the right, the words National Educational Music Company are written in large black capital letters. The overall tone is professional and friendly, representing a music company."/>
    <h1>Summer Workshop 2025 Reading Session Titles</h1>
    <div class="instructions">
        <p>To generate a quote: Select titles by checking the box and pressing generate quote button. If you need a quote on other titles, please send your request to your NEMC representative or email <a href="mailto:sales@nemc.com">sales@nemc.com</a> </p>
    </div>

    <div class="card-container" id="card-container"></div>
    <div class="button-container"><button id="generate-quote-btn">Generate Quote</button>
    <button id="download-pdf-btn" style="display: none;">Download PDF</button></div>


    <div id="quote-output" class="quote-box" style="margin-top: 30px; display: none"></div>

    <script>
        window.addEventListener("DOMContentLoaded", () => {
            fetch("Workshop2025Titles.json")
                .then(response => response.json())
                .then(data => {
                    const cardContainer = document.getElementById("card-container");

                    data.forEach(item => {
                        const card = document.createElement("div");
                        card.className = "card";

                        card.innerHTML = `
              <h5>${item.Title}</h5>
              <div><em>${item.Composer}</em></div>
              <div><strong>Publisher:</strong> ${item["Publisher"]}</div>
              <div class="itemid"><strong>Item #:</strong> ${item["Item #"]}</div>
              <div class="price-original">Retail: $${Number(item.Retail).toFixed(2)}</div>
              <div class="price-discounted">Your Price: $${Number(item.Discounted).toFixed(2)}<input type="checkbox" class="checkbox" />
                
              </div>
              
            
              <a href="${item.Link}" target="_blank">View Title</a>
             
            `;

                        cardContainer.appendChild(card);
                    });
                })
                .catch(err => {
                    console.error("Error loading JSON:", err);
                    document.getElementById("card-container").innerHTML = "<p>Failed to load titles.</p>";
                });
        });

        const generateQuoteBtn = document.getElementById("generate-quote-btn");
        const downloadPDFBtn = document.getElementById("download-pdf-btn");
        const quoteOutput = document.getElementById("quote-output");

        generateQuoteBtn.addEventListener("click", () => {
            const selectedCards = document.querySelectorAll(".card input[type='checkbox']:checked");
            quoteOutput.innerHTML = "";
            downloadPDFBtn.style.display = "none";
            quoteOutput.style.display = "block";

            if (selectedCards.length === 0) {
                alert("Please select at least one title to generate a quote.");
                return;
            }

            let total = 0;
            const today = new Date().toLocaleDateString();

            let quoteHTML = `
     
      <div class="quote-header" margin-top: 10px">
          <div class="quote-info" style="font-size: 14px;">
              <strong>National Educational Music Co.</strong><br>
              1110 Centennial Ave, STE2<br>
              Piscataway, NJ 08854<br>
              Phone: (800) 526-4593<br>
              Email: sales@nemc.com
              
          </div>
      
          <div class="school-info">
                <strong>Teacher:</strong> ${teacherData.name}<br>
                <strong>District:</strong> ${teacherData.district}<br>
                <strong>School:</strong> ${teacherData.school}<br>
                <strong>Email:</strong> ${teacherData.email}
            </div>
    </div>

      <h3 style="margin-bottom: 5px;">Price Quote</h3>
      <div style="margin-bottom: 20px; font-size: 14px;">Date: ${today}</div>

      <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
          <thead>
              <tr>
                  <th style="border: 1px solid #ccc; padding: 8px; text-align: left;">Title</th>
                  <th style="border: 1px solid #ccc; padding: 8px; text-align: left;">Item #</th>
                  <th style="border: 1px solid #ccc; padding: 8px; text-align: right;">Price</th>
              </tr>
          </thead>
          <tbody>
       
            </div>
                 <div class="quote-footer" style="color: grey">Prices good for 65 days from quote date.</div>
      `;

            selectedCards.forEach(card => {
                const parent = card.closest(".card");
                const title = parent.querySelector("h5")?.innerText || "Untitled";
                const priceText = parent.querySelector(".price-discounted")?.innerText || "$0";
                const price = parseFloat(priceText.replace(/[^0-9.]/g, ""));
                const itemID = parent.querySelector(".itemid")?.innerText.replace("Item #:", "").trim() || "No ID";

                if (!isNaN(price)) {
                    total += price;
                    quoteHTML += `
          <tr>
              <td style="border: 1px solid #ccc; padding: 8px;">${title}</td>
              <td style="border: 1px solid #ccc; padding: 8px;">${itemID}</td>
              <td style="border: 1px solid #ccc; padding: 8px; text-align: right;">$${price.toFixed(2)}</td>
          </tr>`;
                }
            });

            quoteHTML += `
          <tr>
              <td colspan="2" style="border: 1px solid #ccc; padding: 8px; text-align: right;"><strong>Shipping</strong></td>
              <td style="border: 1px solid #ccc; padding: 8px; text-align: right;">$0.00</td>
          </tr>
          <tr>
              <td colspan="2" style="border: 1px solid #ccc; padding: 8px; text-align: right;"><strong>Total</strong></td>
              <td style="border: 1px solid #ccc; padding: 8px; text-align: right;"><strong>$${total.toFixed(2)}</strong></td>
          </tr>
          </tbody>
      </table>
      `;

            quoteOutput.innerHTML = quoteHTML;
            
            //NEW FUNCTIONALITY
            const clone = quoteOutput.cloneNode(true);
            clone.style.width = "8.5"; // Ensure the cloned element is full width
            clone.style.padding = "20px"; // Add padding for better appearance
            clone.style.boxSizing = "border-box"; // Ensure padding is included in width
            clone.style.backgroundColor = "#fff"; // Set background color for PDF
            clone.style.fontSize = "14px"; // Set font size for consistency
            clone.style.color = "#000"; // Set text color for PDF
            clone.style.margin = "0"; // Remove margin for PDF
            clone.style.border = "none"; // Remove border for PDF
            clone.style.pageBreakAfter = "always"; // Ensure proper page breaks in PDF
            clone.style.display = "block"; // Ensure it displays as a block element
            clone.style.lineHeight = "1"; // Set line height for readability
            clone.style.fontFamily = "Arial, sans-serif"; // Set font family for consistency
            clone.style.textAlign = "left"; // Align text to the left for PDF
            clone.style.borderCollapse = "collapse"; // Ensure table borders collapse for PDF
            clone.style.boxShadow = "none"; // Remove any box shadow for PDF
            clone.style.backgroundColor = "#fff"; // Set a light background color for PDF    
            html2pdf()

                .from(clone)
             .save('sheetmusic_quote.pdf')
                .then(() => {
                    console.log("PDF generated successfully.");
                })
                .catch(err => {
                    console.error("Error generating PDF:", err);
                });

            // .set({
            //     margin: 0,
            //     filename: 'workshop_quote.pdf',
            //     html2canvas: { scale: 2 },
            //     jsPDF: { unit: 'in', format: 'letter', orientation: 'p' }
            // })
   
        // END NEW FUNCTION







         //   downloadPDFBtn.style.display = "inline-block";
        });

        downloadPDFBtn.addEventListener("click", () => {
            const clone = quoteOutput.cloneNode(true);
            clone.style.width = "8.5"; // Ensure the cloned element is full width
            clone.style.padding = "20px"; // Add padding for better appearance
            clone.style.boxSizing = "border-box"; // Ensure padding is included in width
            clone.style.backgroundColor = "#fff"; // Set background color for PDF
            clone.style.fontSize = "14px"; // Set font size for consistency
            clone.style.color = "#000"; // Set text color for PDF
            clone.style.margin = "0"; // Remove margin for PDF
            clone.style.border = "none"; // Remove border for PDF
            clone.style.pageBreakAfter = "always"; // Ensure proper page breaks in PDF
            clone.style.display = "block"; // Ensure it displays as a block element
            clone.style.lineHeight = "1"; // Set line height for readability
            clone.style.fontFamily = "Arial, sans-serif"; // Set font family for consistency
            clone.style.textAlign = "left"; // Align text to the left for PDF
            clone.style.borderCollapse = "collapse"; // Ensure table borders collapse for PDF
            clone.style.boxShadow = "none"; // Remove any box shadow for PDF
            clone.style.backgroundColor = "#fff"; // Set a light background color for PDF    
                html2pdf()
                
                    .from(clone)
                    .set({
                        margin: 0,
                        filename: 'workshop_quote.pdf',
                        html2canvas: { scale: 2 },
                        jsPDF: { unit: 'in', format: 'letter', orientation: 'p' }
                    }).save('workshop_quote.pdf')
                    .then(() => {
                        console.log("PDF generated successfully.");
                    })
                    .catch(err => {
                        console.error("Error generating PDF:", err);
                    });
   

                    });
            

    </script>
    <script>
        let teacherData = {};

        window.addEventListener("DOMContentLoaded", () => {
            const modal = document.getElementById("info-form-modal");
            modal.style.display = "flex";

            const form = document.getElementById("teacher-info-form");
            form.addEventListener("submit", (e) => {
                e.preventDefault();
                teacherData = {
                    name: document.getElementById("teacher-name").value.trim(),
                    school: document.getElementById("school-name").value.trim(),
                    district: document.getElementById("district-name").value.trim(),
                    email: document.getElementById("email").value.trim()
                };
                modal.style.display = "none";
            });
        });
    </script>
</body>

</html>